# 얼굴인식 프로젝트

## Step1 - 얼굴 사진 100장 찍어 데이터 수집하기
- CascadeClassifier는, 단순히 얼굴 검출기라기보다는, 유사-하르 필터를 이용하여 유사도로 특정 객체를 검출해내는 검출기로, 어떤 객체를 검출할지를 바로 이 xml파일에 설정함으로써 변경 가능하고, load 메소드를 통해 미리 훈련된 분류기 정보를 가져올수 있습니다.
- 미리 훈련된 분류기 XML 파일은 OpenCV에서 제공

```python
import cv2
import numpy as np
import os

  

# 유사-하르 필터를 이용한 얼굴 검출기 CascadeClassifier을 사용하여 분류기를 face_classifier 로 지정하기

face_classifier = cv2.CascadeClassifier(cv2.data.haarcascades + 'haarcascade_frontalface_default.xml')

  

# 전체 사진에서 얼굴 부위만 추출하는 함수
def face_extractor(img):

    # 흑백처리
    gray = cv2.cvtColor(img, cv2.COLOR_BGR2GRAY)

    # 얼굴 찾기
    faces = face_classifier.detectMultiScale(
        gray,
        scaleFactor=1.1,     # 더 세밀하게 얼굴 탐지
        minNeighbors=4,      # 노이즈 줄이기
        minSize=(80, 80)     # 너무 작은 얼굴은 무시
    )

    if len(faces) == 0:
        return None

    for (x, y, w, h) in faces:
        # 해당 얼굴 크기만큼 cropped_face에 잘라 넣기
        # 근데... 얼굴이 2개 이상 감지되면?? 가장 마지막의 얼굴만 남을 듯
        cropped_face = img[y:y + h, x:x + w]
    return cropped_face

# 저장 폴더 생성
save_dir = 'faces'
os.makedirs(save_dir, exist_ok=True)

# 카메라 실행
cap = cv2.VideoCapture(0)
# 저장할 이미지 카운트 변수
count = 0

while True:
    ret, frame = cap.read()
    if not ret:
        print("카메라 프레임을 읽을 수 없습니다.")
        break
    # 얼굴 감지 하여 얼굴만 가져오기
    face_img = face_extractor(frame)
    if face_img is not None:
        count += 1
        # 얼굴 이미지 크기를 200x200으로 조정
        face = cv2.resize(face_extractor(frame), (200, 200))
        # 조정된 이미지를 흑백으로 변환
        face = cv2.cvtColor(face, cv2.COLOR_BGR2GRAY)
        # ex > faces/user0.jpg   faces/user1.jpg ....
        file_path = os.path.join(save_dir, f'user{count}.jpg')
        cv2.imwrite(file_path, face)  # faces폴더에 jpg파일로 저장

        # 화면에 얼굴과 현재 저장 개수 표시
        cv2.putText(face, str(count), (50, 50), cv2.FONT_HERSHEY_COMPLEX, 1, (0, 255, 0), 2)
        cv2.imshow('Face Cropper', face)
    else:
        print("Face not Found")
  
    if cv2.waitKey(10) == ord('q') or count == 100:
        break
  
cap.release()
cv2.destroyAllWindows()
print('Colleting Samples Complete!!!')
```

## Step2 - 100장의 사진을 학습 시키기


- LBPH (Local Binary Patterns Histograms) : 전통적인 머신러닝 기반 모델
    - grayscale 이미지만 사용
    - 간단한 수치 비교, 패턴 분석
    - 조명, 각도, 표정 변화에 약함

- 필요한 라이브러리

```python
    Python 3.7-3.11
    pip install opencv-contrib-python==4.8.1.78
    pip install numpy==1.26.4
```

```python

```